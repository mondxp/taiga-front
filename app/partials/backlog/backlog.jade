doctype html

div.wrapper(tg-backlog, ng-controller="BacklogController as ctrl",
            ng-init="section='backlog'")
    tg-project-menu


    section.main.backlog
        include ../includes/components/mainTitle

        div.backlog-summary(tg-toggle-burndown-visibility)
            include ../includes/components/summary

            div.empty-burndown(ng-if="showGraphPlaceholder && project.i_am_admin")
                tg-svg(svg-icon="icon-graph")
                div.empty-text
                    p.title(translate="BACKLOG.CUSTOMIZE_GRAPH")
                    p {{'BACKLOG.CUSTOMIZE_GRAPH_TEXT' | translate}} #[a(href="", tg-nav="project-admin-project-values-points:project=project.slug", title="{{'BACKLOG.CUSTOMIZE_GRAPH_TITLE' | translate}}") {{'BACKLOG.CUSTOMIZE_GRAPH_ADMIN' | translate}}]

            div.graphics-container.js-burndown-graph
                div.burndown(tg-burndown-backlog-graph)

        .backlog-table

            .backlog-menu
                .backlog-header
                    .backlog-header-title
                        h2 Backlog
                        span.backlog-stories-number {{userstories.length}} user stories
                    .backlog-header-options
                        include ../includes/components/addnewus

                .backlog-table-options
                    .backlog-table-options-start
                        button.filter-button.e2e-open-filter.ng-animate-disabled(
                            id="show-filters-button"
                            ng-class="{'active': ctrl.activeFilters}"
                        )
                            tg-svg(svg-icon="icon-filters")
                            span.text(translate="BACKLOG.FILTERS.TITLE")
                            span.selected-filters(ng-if="ctrl.selectedFilters.length") {{ctrl.selectedFilters.length}}

                        tg-input-search(
                            q="ctrl.filterQ"
                            change="ctrl.changeQ(q)"
                        )

                        .display-tags-button#show-tags

                            .check.js-check(
                                ng-if="userstories.length"
                                ng-class="{'active': ctrl.showTags}"
                            )
                                input(
                                    type="checkbox"
                                    id="show-tags-input"
                                    ng-checked="ctrl.showTags"
                                    ng-model="ctrl.showTags"
                                )
                                div
                            label(
                                for="show-tags-input"
                                translate="BACKLOG.TAGS.SHOW"
                            )

                    .backlog-table-options-end
                        button.filter-button.velocity-forecasting-btn.ng-animate-disabled.e2e-velocity-forecasting(
                            ng-if="userstories.length && ctrl.displayVelocity "
                            title="{{'BACKLOG.FORECASTING.TITLE' | translate}}"
                            translate="BACKLOG.FORECASTING.BACKLOG"
                            ng-click="ctrl.toggleVelocityForecasting()"
                            tg-check-permission="add_milestone"
                        )
                        button.filter-button.velocity-forecasting-btn.ng-animate-disabled.e2e-velocity-forecasting(
                            ng-if="userstories.length && !ctrl.displayVelocity && stats.speed > 0"
                            title="{{'BACKLOG.FORECASTING.BACKLOG' | translate}}"
                            translate="BACKLOG.FORECASTING.TITLE"
                            ng-click="ctrl.toggleVelocityForecasting()"
                            tg-check-permission="add_milestone"
                        )
                        button.filter-button.move-to-current-sprint.move-to-sprint.e2e-move-to-sprint(
                            ng-if="currentSprint"
                            title="{{'BACKLOG.MOVE_US_TO_CURRENT_SPRINT' | translate}}"
                            id="move-to-current-sprint"
                        )
                            tg-svg(svg-icon="icon-move")
                            span.text(translate="BACKLOG.MOVE_US_TO_CURRENT_SPRINT")
                        button.filter-button.move-to-latest-sprint.move-to-sprint.e2e-move-to-sprint(
                            ng-if="!currentSprint"
                            title="{{'BACKLOG.MOVE_US_TO_LATEST_SPRINT' | translate}}"
                            id="move-to-latest-sprint"
                        )
                            tg-svg(svg-icon="icon-move")
                            span.text(translate="BACKLOG.MOVE_US_TO_LATEST_SPRINT")

            .backlog-manager

                .backlog-filter(
                    id="backlog-filter"
                    ng-if="ctrl.activeFilters"
                )
                    tg-filter(
                        filters="ctrl.filters"
                        custom-filters="ctrl.customFilters"
                        selected-filters="ctrl.selectedFilters"
                        customFilters="ctl.customFilters"
                        on-save-custom-filter="ctrl.saveCustomFilter(name)"
                        on-add-filter="ctrl.addFilter(filter)"
                        on-select-custom-filter="ctrl.selectCustomFilter(filter)"
                        on-remove-custom-filter="ctrl.removeCustomFilter(filter)"
                        on-remove-filter="ctrl.removeFilter(filter)"
                        on-change-q="ctrl.changeQ(q)"
                    )

                section.backlog-table(ng-class="{'hidden': !userstories.length}")
                    include ../includes/modules/backlog-table

                .empty-backlog.js-empty-backlog(ng-class="{'hidden': userstories === undefined || !!userstories.length || !ctrl.filterQ.length}")
                    p.no-match {{ 'BACKLOG.NO_MATCH' | translate:ctrl.translationData }}
                    p.no-match-help {{ 'BACKLOG.NO_MATCH_HELP' | translate }}

                .empty-large.js-empty-backlog(ng-class="{'hidden': userstories === undefined || !!userstories.length || ctrl.filterQ.length}")
                    img(
                        src="/#{v}/images/empty/empty_mex.png"
                        alt="{{'BACKLOG.EMPTY' | translate}}"
                    )
                    p.title(translate="BACKLOG.EMPTY")
                    a(
                        href=""
                        title="{{'BACKLOG.CREATE_NEW_US' | translate}}"
                        ng-click="ctrl.addNewUs('standard')"
                        tg-check-permission="add_us"
                        translate="BACKLOG.CREATE_NEW_US_EMPTY_HELP"
                )

            .forecasting-add-sprint.e2e-velocity-forecasting-add(ng-if="ctrl.displayVelocity")
                tg-svg(svg-icon="icon-add")
                span(
                    ng-if="!currentSprint"
                    translate="BACKLOG.FORECASTING.NEW_SPRINT"
                )
                span(
                    ng-if="currentSprint"
                    translate="BACKLOG.FORECASTING.CURRENT_SPRINT"
                )

    sidebar.menu-secondary.sidebar
        include ../includes/modules/sprints

    div.lightbox.lightbox-generic-form.lightbox-create-edit(tg-lb-create-edit)

    div.lightbox.lightbox-generic-bulk(tg-lb-create-bulk-userstories)
        include ../includes/modules/lightbox-us-bulk

    div.lightbox.lightbox-sprint-add-edit(tg-lb-create-edit-sprint)
        include ../includes/modules/lightbox-sprint-add-edit
